---
export interface Props {
  id: string;
  title?: string;
  thumbQuality?: "hqdefault" | "mqdefault" | "sddefault";
}

const { id, title = "Entrevista Cefem", thumbQuality = "hqdefault" } = Astro.props as Props;
const thumb = `https://img.youtube.com/vi/${id}/${thumbQuality}.jpg`;
---
<style>
.yt-lite{position:relative;display:block;aspect-ratio:16/9;background:#000;cursor:pointer}
.yt-lite>img{width:100%;height:100%;object-fit:cover;display:block}
.yt-lite>button{position:absolute;inset:0;margin:auto;width:68px;height:48px;border:0;border-radius:12px;background:rgba(255,255,255,.9);font-size:20px;line-height:48px}
.yt-lite.loaded{cursor:auto}
</style>

<div class="yt-lite" data-id={id} role="button" aria-label={`Reproducir video: ${title}`}>
  <img src={thumb} alt={title} loading="lazy" width="1280" height="720" />
  <button aria-hidden="true">â–¶</button>
</div>

<script is:inline>
if (typeof window !== 'undefined') {
  if (!window.__cefemActivateLitePlayer) {
    window.__cefemActivateLitePlayer = (container) => {
      if (!container || container.classList.contains('loaded')) return;
      const id = container.getAttribute('data-id');
      if (!id) return;
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&rel=0`;
      iframe.title = 'YouTube video player';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
      iframe.allowFullscreen = true;
      iframe.loading = 'lazy';
      iframe.style.cssText = 'position:absolute;inset:0;width:100%;height:100%;border:0;';
      container.textContent = '';
      container.appendChild(iframe);
      container.classList.add('loaded');
      window.dispatchEvent(new CustomEvent('cefem:video_play', { detail: { id } }));
    };
  }

  if (!window.__cefemYoutubeLiteInitialized) {
    window.__cefemYoutubeLiteInitialized = true;
    document.addEventListener('click', (event) => {
      const target = event.target.closest('.yt-lite');
      if (!target) return;
      window.__cefemActivateLitePlayer(target);
    });
  }
}
</script>
